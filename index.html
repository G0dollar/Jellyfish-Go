<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Jellyfish Sprint Pro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --bg-deep: #001220;
            --accent: #00d2ff;
            --gold: #ffd700; --silver: #c0c0c0; --bronze: #cd7f32;
            --jelly-1: #ff7675; --jelly-2: #fdcb6e; --jelly-3: #55efc4; --jelly-4: #a29bfe; --jelly-5: #fab1a0;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg-deep);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        /* UI Styling */
        header {
            display: flex;
            justify-content: space-between;
            width: 95vw;
            max-width: 900px;
            align-items: center;
            padding: 10px 0;
        }

        #currency-display {
            background: rgba(255, 215, 0, 0.2);
            padding: 8px 15px;
            border-radius: 15px;
            border: 1px solid var(--gold);
            color: var(--gold);
            font-weight: bold;
        }

        #ui-panel {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px 25px;
            border-radius: 50px;
            margin-bottom: 15px;
            display: flex;
            gap: 15px;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        select, button {
            padding: 8px 15px;
            border-radius: 20px;
            border: 2px solid var(--accent);
            background: rgba(0,0,0,0.4);
            color: white;
            outline: none;
        }

        button {
            background: var(--accent);
            color: var(--bg-deep);
            font-weight: bold;
            cursor: pointer;
        }

        button:disabled { opacity: 0.3; cursor: not-allowed; }

        /* Game Tank */
        #tank {
            position: relative;
            width: 95vw;
            max-width: 900px;
            height: 400px;
            background: linear-gradient(180deg, #002d4d 0%, #001220 100%);
            border-radius: 20px;
            overflow: hidden;
            border: 2px solid rgba(0, 210, 255, 0.2);
        }

        .lane {
            position: absolute;
            width: 100%;
            height: 20%;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            padding-left: 10px;
            color: rgba(255,255,255,0.1);
            font-size: 10px;
            display: flex;
            align-items: center;
        }

        .jellyfish-container {
            position: absolute;
            left: 20px;
            width: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
        }

        .jelly-label {
            background: rgba(0, 0, 0, 0.6);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            margin-bottom: 5px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .my-pick-glow { filter: drop-shadow(0 0 10px var(--accent)) brightness(1.2); }

        .jelly-body {
            height: 30px;
            width: 40px;
            border-radius: 50% 50% 30% 30%;
        }

        .tentacle {
            width: 3px;
            height: 18px;
            border-radius: 3px;
            animation: swim 1.2s ease-in-out infinite alternate;
        }

        @keyframes swim {
            from { height: 10px; transform: scaleX(1.2); }
            to { height: 20px; transform: scaleX(0.8); }
        }

        /* End Screen Overlay */
        #end-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 18, 32, 0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            text-align: center;
        }

        #final-board {
            margin: 20px 0;
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 15px;
            width: 250px;
        }

        .final-rank { margin: 10px 0; padding: 5px; border-radius: 5px; }

        .bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 50%;
            bottom: -20px;
            animation: rise linear infinite;
        }

        @keyframes rise { to { transform: translateY(-500px); opacity: 0; } }
    </style>
</head>

<body>

<header>
    <h1>ðŸª¼ DEEP SEA DERBY</h1>
    <div id="currency-display">Sand Dollars: <span id="balance">100</span></div>
</header>

<div id="ui-panel">
    <span>Pick Winner (Cost: 25):</span>
    <select id="bet">
        <option value="0">Jelly 1 (Pink)</option>
        <option value="1">Jelly 2 (Gold)</option>
        <option value="2">Jelly 3 (Mint)</option>
        <option value="3">Jelly 4 (Purple)</option>
        <option value="4">Jelly 5 (Peach)</option>
    </select>
    <button id="startBtn" onclick="startRace()">LAUNCH RACE</button>
</div>

<div id="tank">
    <div id="end-screen">
        <h2 id="result-text">Race Finished!</h2>
        <div id="final-board"></div>
        <button onclick="closeEndScreen()">Retry (-25)</button>
    </div>
</div>

<script>
    const tank = document.getElementById("tank");
    const startBtn = document.getElementById("startBtn");
    const balanceEl = document.getElementById("balance");
    const endScreen = document.getElementById("end-screen");
    const finalBoard = document.getElementById("final-board");
    
    let balance = 100;
    const colors = ['var(--jelly-1)', 'var(--jelly-2)', 'var(--jelly-3)', 'var(--jelly-4)', 'var(--jelly-5)'];
    let racers = [];
    let racing = false;
    let winners = [];

    // Init Bubbles
    for(let i = 0; i < 20; i++) {
        const b = document.createElement("div");
        b.className = "bubble";
        const size = Math.random() * 5 + 2;
        b.style.width = size + "px"; b.style.height = size + "px";
        b.style.left = Math.random() * 100 + "%";
        b.style.animationDuration = (Math.random() * 3 + 3) + "s";
        tank.appendChild(b);
    }

    // Setup Racers
    for (let i = 0; i < 5; i++) {
        const lane = document.createElement("div");
        lane.className = "lane";
        lane.style.top = (i * 20) + "%";
        tank.appendChild(lane);

        const container = document.createElement("div");
        container.className = "jellyfish-container";
        container.style.top = (i * 20 + 4) + "%";
        container.innerHTML = `
            <div class="jelly-label">J-${i+1}</div>
            <div class="jelly-body" style="background: ${colors[i]}"></div>
            <div class="tentacles" style="display:flex; justify-content:space-around; width:35px">
                <div class="tentacle" style="background: ${colors[i]}"></div>
                <div class="tentacle" style="background: ${colors[i]}"></div>
                <div class="tentacle" style="background: ${colors[i]}"></div>
            </div>`;
        tank.appendChild(container);
        racers.push({ el: container, x: 20, velocity: 0, finished: false, id: i });
    }

    function startRace() {
        if (racing) return;
        if (balance < 25) {
            alert("Not enough Sand Dollars! (Refresh to restart your wallet)");
            return;
        }

        // Deduct Currency
        balance -= 25;
        balanceEl.innerText = balance;

        racing = true;
        winners = [];
        startBtn.disabled = true;
        endScreen.style.display = "none";
        
        const betValue = parseInt(document.getElementById("bet").value);
        
        racers.forEach((r, idx) => {
            r.x = 20; r.velocity = 0; r.finished = false;
            r.el.style.left = "20px";
            r.el.classList.toggle('my-pick-glow', idx === betValue);
        });

        const finishLine = tank.clientWidth - 80;

        function animate() {
            racers.forEach(r => {
                if (r.finished) return;
                const drag = 0.988;
                const pulse = Math.random() > 0.97 ? (Math.random() * 1.5) : 0;
                r.velocity = (r.velocity * drag) + pulse + (Math.random() * 0.1);
                r.x += r.velocity;
                r.el.style.left = r.x + "px";

                if (r.x >= finishLine) {
                    r.finished = true;
                    winners.push(r);
                }
            });

            if (winners.length < 5) requestAnimationFrame(animate);
            else showEndScreen(betValue);
        }
        requestAnimationFrame(animate);
    }

    function showEndScreen(bet) {
        racing = false;
        endScreen.style.display = "flex";
        finalBoard.innerHTML = "";
        
        const isWinner = winners[0].id === bet;
        if (isWinner) {
            balance += 75; // Reward for winning
            balanceEl.innerText = balance;
            document.getElementById("result-text").innerText = "ðŸ† YOU WON!";
            document.getElementById("result-text").style.color = "var(--gold)";
        } else {
            document.getElementById("result-text").innerText = "ðŸ RACE OVER";
            document.getElementById("result-text").style.color = "white";
        }

        winners.slice(0, 3).forEach((w, idx) => {
            const div = document.createElement("div");
            div.className = "final-rank";
            const medal = idx === 0 ? "ðŸ¥‡" : idx === 1 ? "ðŸ¥ˆ" : "ðŸ¥‰";
            div.innerHTML = `${medal} #${idx+1} - Jellyfish ${w.id + 1}`;
            finalBoard.appendChild(div);
        });
    }

    function closeEndScreen() {
        startRace(); // Trigger next race immediately
    }
</script>

</body>
</html>